---
import type { NotionMedia } from "../lib/notion";

export interface Props {
	video: NotionMedia;
	title?: string;
	subtitle?: string;
	ctaText?: string;
	ctaLink?: string;
	overlay?: "light" | "dark" | "gradient" | "none";
	textPosition?: "left" | "center" | "right";
	className?: string;
	autoplay?: boolean;
	fullHeight?: boolean;
}

const {
	video,
	title,
	subtitle,
	ctaText,
	ctaLink,
	overlay = "gradient",
	textPosition = "center",
	className = "",
	autoplay = false,
	fullHeight = false,
} = Astro.props;

const overlayClasses = {
	light: "bg-white/30 backdrop-blur-sm",
	dark: "bg-black/50 backdrop-blur-sm",
	gradient: "bg-gradient-to-t from-black/80 via-black/40 to-transparent",
	none: "",
};

const positionClasses = {
	left: "items-start text-left",
	center: "items-center text-center",
	right: "items-end text-right",
};

const videoId = `featured-video-${Math.random().toString(36).substr(2, 9)}`;
---

<section
	class={`featured-video-section relative ${fullHeight ? "min-h-screen" : "min-h-[70vh]"} flex items-center justify-center overflow-hidden ${className}`}
>
	<!-- Video Background -->
	<div class="absolute inset-0 z-0">
		<video
			id={videoId}
			src={video.url}
			poster={video.thumbnail}
			autoplay={autoplay}
			muted
			loop
			playsinline
			preload="metadata"
			class="w-full h-full object-cover"
		>
			Your browser does not support the video tag.
		</video>

		<!-- Overlay -->
		{
			overlay !== "none" && (
				<div class={`absolute inset-0 ${overlayClasses[overlay]}`} />
			)
		}
	</div>

	<!-- Content -->
	<div
		class={`relative z-10 max-w-7xl mx-auto px-6 py-20 flex flex-col ${positionClasses[textPosition]} w-full`}
	>
		{
			(title || subtitle || ctaText) && (
				<div
					class={`max-w-4xl space-y-6 ${textPosition === "center" ? "mx-auto" : ""}`}
				>
					{title && (
						<h2 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white drop-shadow-2xl animate-fade-in">
							{title}
						</h2>
					)}

					{subtitle && (
						<p class="text-xl md:text-2xl text-gray-100 drop-shadow-lg animate-fade-in-delay">
							{subtitle}
						</p>
					)}

					{ctaText && ctaLink && (
						<div class="pt-4 animate-fade-in-delay-2">
							<a
								href={ctaLink}
								class="btn btn-primary btn-lg shadow-2xl hover:scale-105 transition-transform"
							>
								{ctaText}
							</a>
						</div>
					)}
				</div>
			)
		}

		<!-- Custom Play/Pause Button (optional, only when not autoplay) -->
		{
			!autoplay && (
				<button
					id={`play-btn-${videoId}`}
					class="play-toggle-btn absolute bottom-8 right-8 bg-white/20 hover:bg-white/30 backdrop-blur-md text-white rounded-full p-4 transition-all duration-300 hover:scale-110 shadow-xl"
					aria-label="Toggle video playback"
				>
					<svg
						class="play-icon w-6 h-6"
						fill="currentColor"
						viewBox="0 0 20 20"
					>
						<path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
					</svg>
					<svg
						class="pause-icon w-6 h-6 hidden"
						fill="currentColor"
						viewBox="0 0 20 20"
					>
						<path d="M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z" />
					</svg>
				</button>
			)
		}
	</div>

	<!-- Scroll Indicator (optional) -->
	<div
		class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-10 animate-bounce"
	>
		<svg
			class="w-6 h-6 text-white opacity-70"
			fill="none"
			stroke="currentColor"
			viewBox="0 0 24 24"
		>
			<path
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
		</svg>
	</div>
</section>

<script>
	function initFeaturedVideo() {
		const playToggleButtons = document.querySelectorAll(".play-toggle-btn");

		playToggleButtons.forEach((button) => {
			const videoId = button.id.replace("play-btn-", "");
			const video = document.getElementById(videoId) as HTMLVideoElement;
			const playIcon = button.querySelector(".play-icon");
			const pauseIcon = button.querySelector(".pause-icon");

			if (!video || !playIcon || !pauseIcon) return;

			// Update button state based on video state
			const updateButton = () => {
				if (video.paused) {
					playIcon.classList.remove("hidden");
					pauseIcon.classList.add("hidden");
				} else {
					playIcon.classList.add("hidden");
					pauseIcon.classList.remove("hidden");
				}
			};

			// Toggle play/pause
			button.addEventListener("click", () => {
				if (video.paused) {
					video.play();
				} else {
					video.pause();
				}
				updateButton();
			});

			// Update button when video state changes
			video.addEventListener("play", updateButton);
			video.addEventListener("pause", updateButton);

			// Initial state
			updateButton();
		});
	}

	// Initialize on page load
	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", initFeaturedVideo);
	} else {
		initFeaturedVideo();
	}
</script>

<style>
	@keyframes fade-in {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.animate-fade-in {
		animation: fade-in 1s ease-out forwards;
	}

	.animate-fade-in-delay {
		opacity: 0;
		animation: fade-in 1s ease-out 0.3s forwards;
	}

	.animate-fade-in-delay-2 {
		opacity: 0;
		animation: fade-in 1s ease-out 0.6s forwards;
	}

	@media (prefers-reduced-motion: reduce) {
		.animate-fade-in,
		.animate-fade-in-delay,
		.animate-fade-in-delay-2,
		.animate-bounce {
			animation: none;
			opacity: 1;
			transform: none;
		}
	}
</style>
