---
import VideoPlayer from "./VideoPlayer.astro";
import type { NotionMedia } from "../lib/notion";

export interface Props {
	videos: NotionMedia[];
	columns?: 1 | 2 | 3 | 4;
	aspectRatio?: "video" | "square" | "wide" | "portrait";
	showTitles?: boolean;
	showDescriptions?: boolean;
	className?: string;
	maxVideos?: number;
}

const {
	videos,
	columns = 3,
	aspectRatio = "video",
	showTitles = true,
	showDescriptions = false,
	className = "",
	maxVideos,
} = Astro.props;

const displayVideos = maxVideos ? videos.slice(0, maxVideos) : videos;

const gridClasses = {
	1: "grid-cols-1",
	2: "grid-cols-1 md:grid-cols-2",
	3: "grid-cols-1 md:grid-cols-2 lg:grid-cols-3",
	4: "grid-cols-1 md:grid-cols-2 lg:grid-cols-4",
};
---

<div class={`video-grid ${className}`}>
	{
		displayVideos.length > 0 ? (
			<div class={`grid ${gridClasses[columns]} gap-6`}>
				{displayVideos.map((video) => (
					<div class="video-grid-item transform transition-all duration-300 hover:scale-105">
						<VideoPlayer
							src={video.url}
							poster={video.thumbnail}
							title={showTitles ? video.title : undefined}
							description={
								showDescriptions ? video.description : undefined
							}
							aspectRatio={aspectRatio}
							autoplay={false}
							controls={true}
							loop={true}
							muted={true}
							showPlayButton={true}
						/>
						{showTitles && video.title && !showDescriptions && (
							<div class="mt-3">
								<h4 class="text-white font-semibold text-lg">
									{video.title}
								</h4>
								{video.tags && video.tags.length > 0 && (
									<div class="flex flex-wrap gap-2 mt-2">
										{video.tags.map((tag) => (
											<span class="text-xs px-2 py-1 bg-white/10 text-gray-300 rounded-full">
												{tag}
											</span>
										))}
									</div>
								)}
							</div>
						)}
					</div>
				))}
			</div>
		) : (
			<div class="text-center py-12">
				<p class="text-gray-400 text-lg">No videos available yet.</p>
			</div>
		)
	}
</div>

<style>
	.video-grid-item {
		will-change: transform;
	}

	@media (prefers-reduced-motion: reduce) {
		.video-grid-item {
			transform: none !important;
			transition: none !important;
		}
	}
</style>
